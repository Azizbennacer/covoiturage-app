<div class="resultats-container">
  <header class="resultats-header">
    <h2 class="resultats-title neon-text">Offres de Covoiturage Disponibles</h2>
    <p *ngIf="resultats?.length > 0" class="resultats-count pulse-effect">
      <span class="highlight-count">{{ resultats.length }}</span> trajet(s)
      correspondant à votre recherche
    </p>
  </header>

  <div *ngIf="resultats?.length > 0; else aucunTrajet" class="trajets-list">
    <article class="carte-trajet" *ngFor="let trajet of resultats" tabindex="0">
      <div class="infos-trajet">
        <div class="trajet-route">
          <h3 class="trajet-ville">
            <span class="ville-depart">{{ trajet.villeDepart }}</span>
            <span class="separator">→</span>
            <span class="ville-arrivee">{{ trajet.villeArrivee }}</span>
          </h3>

          <div class="trajet-meta">
            <time class="trajet-date" [dateTime]="trajet.dateTrajet">
              <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
                <path
                  fill="currentColor"
                  d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"
                />
              </svg>
              {{ trajet.dateTrajet | date : "EEEE dd MMMM yyyy" | titlecase }} à
              {{ trajet.dateTrajet | date : "HH:mm" }}
            </time>

            <div class="trajet-badges">
              <span class="badge badge-price">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16">
                  <path
                    fill="currentColor"
                    d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,7H13A2,2 0 0,1 15,9V15A2,2 0 0,1 13,17V19H11V17A2,2 0 0,1 9,15V9A2,2 0 0,1 11,7M11,9V15H13V9H11Z"
                  />
                </svg>
                {{ trajet.prix }} TND
              </span>
              <span class="badge badge-seats">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16">
                  <path
                    fill="currentColor"
                    d="M3,13A9,9 0 0,0 12,22A9,9 0 0,0 21,13H19A7,7 0 0,1 12,20A7,7 0 0,1 5,13H3M3,7A9,9 0 0,1 12,16A9,9 0 0,1 21,7H19A7,7 0 0,0 12,14A7,7 0 0,0 5,7H3M12,4A3,3 0 0,1 15,7A3,3 0 0,1 12,10A3,3 0 0,1 9,7A3,3 0 0,1 12,4Z"
                  />
                </svg>
                {{ trajet.nbPlaces }} place(s)
              </span>
            </div>
          </div>
        </div>

        <div class="trajet-details">
          <div class="detail-item">
            <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
              <path
                fill="currentColor"
                d="M18.92,6.01C18.72,5.42 18.16,5 17.5,5H15V3H9V5H6.5C5.84,5 5.28,5.42 5.08,6.01L3,12V20A1,1 0 0,0 4,21H5A1,1 0 0,0 6,20V19H18V20A1,1 0 0,0 19,21H20A1,1 0 0,0 21,20V12L18.92,6.01M6.5,16C5.67,16 5,15.33 5,14.5C5,13.67 5.67,13 6.5,13C7.33,13 8,13.67 8,14.5C8,15.33 7.33,16 6.5,16M17.5,16C16.67,16 16,15.33 16,14.5C16,13.67 16.67,13 17.5,13C18.33,13 19,13.67 19,14.5C19,15.33 18.33,16 17.5,16M5,11L6.5,6.5H17.5L19,11H5Z"
              />
            </svg>
            <span>{{ trajet.typeVoiture }}</span>
          </div>
          <div class="detail-item">
            <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
              <path
                fill="currentColor"
                d="M12,3C7.03,3 3,7.03 3,12C3,16.97 7.03,21 12,21C16.97,21 21,16.97 21,12C21,7.03 16.97,3 12,3M12,19C8.14,19 5,15.86 5,12C5,8.14 8.14,5 12,5C15.86,5 19,8.14 19,12C19,15.86 15.86,19 12,19M11,17H13V7H11V17Z"
              />
            </svg>
            <span>{{ trajet.duree }} 45 min</span>
          </div>
        </div>
      </div>

      <div class="conducteur">
        <div class="conducteur-header">
          <h4 class="conducteur-title">Conducteur</h4>
          <div class="conducteur-rating">
            <span class="rating-stars">★★★★★</span>
            <span class="rating-count">(12 avis)</span>
          </div>
        </div>

        <div class="conducteur-body">
          <p class="conducteur-nom">
            <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
              <path
                fill="currentColor"
                d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
              />
            </svg>
            {{ trajet.conducteur.nom }}
          </p>

          <div class="conducteur-actions">
            <a [href]="'tel:' + trajet.conducteur.telephone" class="appel-btn">
              <i class="fas fa-phone"></i>
              Appeler
            </a>

            <button class="message-btn" (click)="contacterConducteur(trajet)">
              <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
                <path
                  fill="currentColor"
                  d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2Z"
                />
              </svg>
              Message
            </button>
          </div>
        </div>
      </div>
    </article>
  </div>

  <ng-template #aucunTrajet>
    <div class="aucun-message">
      <svg class="icon-large" viewBox="0 0 24 24" width="48" height="48">
        <path
          fill="currentColor"
          d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
        />
      </svg>
      <h3>Aucun trajet disponible</h3>
      <p>Nous n'avons trouvé aucun trajet correspondant à vos critères.</p>
      <button class="alerte-btn" (click)="creerAlerte()">
        <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
          <path
            fill="currentColor"
            d="M10,21H14A2,2 0 0,1 12,23A2,2 0 0,1 10,21M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M17,11A5,5 0 0,0 12,6A5,5 0 0,0 7,11V18H17V11M9.5,13.59L8.09,15L10.67,17.59L15.92,12.34L14.5,10.92L10.67,14.76L9.5,13.59Z"
          />
        </svg>
        Créer une alerte
      </button>
    </div>
  </ng-template>
</div>

<!-- ✅ Pop-up de messagerie -->
<div class="popup-container" *ngIf="showMessagePopup">
  <div class="popup">

    <form (ngSubmit)="envoyerMessage()">
      <div class="form-group">
        <label for="message">Envoyer un message à {{ nomConducteurPourMessage }}</label>
        <textarea
          id="message"
          name="message"
          [(ngModel)]="messageEnCours"
          required
          rows="5"
          placeholder="Écrivez votre message ici..."
        ></textarea>
      </div>

      <div class="btn-group">
        <button type="submit" class="btn-submit">Envoyer</button>
        <button type="button" class="btn-close" (click)="fermerPopupMessagerie()">
          Fermer
        </button>
      </div>
    </form>
  </div>
</div>

