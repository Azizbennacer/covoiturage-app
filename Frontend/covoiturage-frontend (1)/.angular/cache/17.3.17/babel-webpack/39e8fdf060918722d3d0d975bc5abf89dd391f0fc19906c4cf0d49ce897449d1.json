{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet MesTrajetsComponent = class MesTrajetsComponent {\n  constructor(trajetService, authService, router) {\n    this.trajetService = trajetService;\n    this.authService = authService;\n    this.router = router;\n    this.trajets = [];\n    // ✅ Pour gérer la pop-up\n    this.showEditPopup = false;\n    // ✅ Copie du trajet en cours d’édition\n    this.trajetEnCours = {\n      id: 0,\n      villeDepart: '',\n      villeArrivee: '',\n      dateTrajet: new Date(),\n      nb_places: 1,\n      prix: 0,\n      type_voiture: '',\n      conducteur: null\n    };\n  }\n  ngOnInit() {\n    const email = this.authService.getUserEmail();\n    console.log(\"Email récupéré dans le component:\", email);\n    if (!email) {\n      console.warn(\"Utilisateur non connecté. Redirection vers /login.\");\n      this.router.navigate(['/login']);\n      return;\n    }\n    this.loadTrajets(email);\n  }\n  loadTrajets(email) {\n    const obs = this.trajetService.getTrajetsByUserEmail();\n    if (!obs) {\n      console.error(\"L'observable est null, probablement à cause d'un email vide\");\n      return;\n    }\n    obs.subscribe({\n      next: trajets => {\n        console.log('Trajets reçus du backend:', trajets);\n        this.trajets = trajets;\n      },\n      error: err => {\n        console.error('Erreur lors de la récupération des trajets:', err);\n      }\n    });\n  }\n  // ✅ Affiche la pop-up avec les données du trajet à modifier\n  modifierTrajet(trajet) {\n    console.log('modifierTrajet appelé', trajet);\n    this.trajetEnCours = {\n      ...trajet\n    };\n    this.showEditPopup = true;\n  }\n  // ✅ Ferme la pop-up\n  fermerPopup() {\n    this.showEditPopup = false;\n  }\n  // ✅ Envoie les modifications au back-end\n  validerModification() {\n    this.trajetService.updateTrajet(this.trajetEnCours).subscribe({\n      next: () => {\n        this.fermerPopup();\n        const email = this.authService.getUserEmail();\n        if (email) {\n          this.loadTrajets(email);\n        }\n      },\n      error: err => {\n        console.error(\"Erreur lors de la modification du trajet:\", err);\n      }\n    });\n  }\n  supprimerTrajet(id) {\n    if (confirm('Voulez-vous vraiment sudeleteTrajetpprimer ce trajet ?')) {\n      this.trajetService.deleteTrajet(id).subscribe(() => {\n        const email = this.authService.getUserEmail();\n        if (email) {\n          this.loadTrajets(email);\n        }\n      });\n    }\n  }\n};\nMesTrajetsComponent = __decorate([Component({\n  selector: 'app-mes-trajets',\n  templateUrl: './trajet-list.component.html',\n  styleUrls: ['./trajet-list.component.css']\n})], MesTrajetsComponent);\nexport { MesTrajetsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}